<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="head">
		<script>
			function sendMsgSocket() {
				webSocket
						.send(document.getElementById("contenido-mensaje").value);
			}
		</script>
		<script>
			function marcarConvSeleccionada(conversacion){
				console.log(conversacion);
				$(".conversaciones").removeClass("LeadenGreenBack")
					.removeClass("SoftGrayBack").removeClass("White")
					.addClass("SoftGrayBack");
				$(conversacion).children().first().addClass("LeadenGreenBack").addClass("White");
			}
		</script>
		
	</ui:define>
	<ui:define name="subheader">
        Mensajeria
    </ui:define>

	<ui:define name="content">
		<div class="Container100 ui-fluid" >
			<h:form id="frmMensajeria" prependId="false">
				<div class="Card ShadowEffect OvAuto OvXHidden chat-container ">
				
					<p:outputPanel id="chatsList" layout="block" 
						styleClass="Container30 Responsive100 OvAuto OvXHidden fullH SoftGrayBack" >
						
						<div class="Container100 fullH" >
							<div class="Card GrayBack ShadowEffect">
						     <p:autoComplete id="selectUsuario" minQueryLength="4"
						     	forceSelection="true" dropdown="true" placeholder="Buscar Usuarios"
								completeMethod="#{usuariosManager.filtrarUsuarios}"	
								var="usuario"
								converter="genericConverter"
								itemValue="#{usuario}"
								itemLabel="#{usuario.nombreCompleto()}">
									<p:ajax event="itemSelect" update="chatBox chatsList" 
										listener="#{mensajeriaManager.onNuevaConversacionSelect}" />
								</p:autoComplete>
						    </div>
						
							<p:repeat value="#{mensajeriaManager.conversaciones}" var="receptor">
								<p:commandLink action="#{mensajeriaManager.seleccionarConversacion(receptor)}" update="chatBox" 
									onclick="marcarConvSeleccionada(this);">
									<p:outputPanel layout="block" styleClass="Card SoftGrayBack BorderBottom conversaciones" >
			                            #{receptor.nombreCompleto()}
									</p:outputPanel>
								</p:commandLink>							
							</p:repeat>
						</div>
							
					</p:outputPanel>
					
					 
					<p:outputPanel id="chatBox" layout="block" styleClass="Container70 Responsive100 fullH msgsCol ">
						<ui:include src="mensajeria-include-conversacion.xhtml" />
					</p:outputPanel>
				</div>
			</h:form>
		</div>
		<style type="text/css">
			.chat-container {
			    height: 70vh;
			}
			.fullH {
				height: 100%;
			}
			.msgsCol {
				position: relative;
			}
			.HeaderChat {
				padding-top: 10px;
				padding-left: 1px;
				position: absolute; 
                top: 0;
			}
			.MainChat {
				height: 100%;
			}
			.FooterChat {
				padding-left: 1px;
				position: absolute; 
                bottom: 0;
			}
			.MsgBox {
			 	padding:5px 10px;
			}
			.OwnMsg {
				float:right;
				margin: 3px 10px 3px 70px;
			}
			.OtherMsg {
				float:left;
				margin: 3px 70px 3px 10px;
			}
			
		</style>
	</ui:define>

</ui:composition>